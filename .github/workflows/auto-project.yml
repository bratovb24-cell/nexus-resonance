name: Auto-add to Project

on:
  issues:
    types: [opened, labeled]

permissions:
  contents: read
  issues: read

jobs:
  add-to-project:
    runs-on: ubuntu-latest

    steps:
      - name: Check if alert issue
        if: contains(github.event.issue.labels.*.name, 'alert')
        run: |
          echo "Alert issue detected: #${{ github.event.issue.number }}"

      - name: Log to VPS
        if: contains(github.event.issue.labels.*.name, 'alert')
        continue-on-error: true
        run: |
          curl -s -X POST "http://176.123.169.38:5000/vps" \
            -H "Content-Type: application/json" \
            -d '{"key":"claude2025","cmd":"python3 /opt/bridge/memory_cli.py add GITHUB_ISSUE_CREATED \"Issue #${{ github.event.issue.number }}: ${{ github.event.issue.title }}\""}' \
            --connect-timeout 10
