name: NEXUS Analyzer Agents (Phase 3)

on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch:
    inputs:
      num_agents:
        description: 'Number of analyzer agents to run'
        required: false
        default: '8'

env:
  PYTHONUNBUFFERED: '1'
  PYTHONIOENCODING: 'utf-8'

jobs:
  analyze:
    name: Run Analyzer Agents
    runs-on: ubuntu-latest

    permissions:
      contents: read
      issues: write
      pull-requests: read

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'
          cache: 'pip'
          cache-dependency-path: '**/requirements.txt'

      - name: Install packages
        shell: bash
        run: |
          python -m pip install --upgrade pip
          pip install requests pyyaml

      - name: Run analyzers
        shell: bash
        env:
          GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}
          NUM_AGENTS: \${{ inputs.num_agents || '8' }}
        run: |
          set -e
          echo "Starting NEXUS Analyzer Agents..."
          python nexus_agents/analyzer.py
          echo "Analyzer completed successfully"

      - name: Done
        if: always()
        run: echo "âœ… Workflow complete"
